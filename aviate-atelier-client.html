<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Aviate Atelier — Charter Flights</title>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,600;0,700;1,400&family=DM+Sans:wght@300;400;500;600;700;800&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#07090F;--bg2:#0C0F18;--bg3:#12151F;
  --card:#12151F;--card2:#181C28;
  --border:#1E2230;--border2:#262B3A;
  --text:#EDF2FF;--text2:#8892A4;--text3:#3E4558;
  --gold:#C8912A;--gold2:#E5A83C;
  --green:#4FD080;--red:#FF5E5E;--blue:#5BA3FF;--orange:#FF9F43;
}
*{margin:0;padding:0;box-sizing:border-box;}
html,body{height:100%;overflow:hidden;background:var(--bg);color:var(--text);font-family:'DM Sans',sans-serif;}
/* VIEWS */
.view{display:none;height:100%;overflow-y:auto;flex-direction:column;}
.view.active{display:flex;}
/* LANDING */
.landing-bg{min-height:100%;background:radial-gradient(ellipse at 60% 20%,rgba(200,145,42,0.08) 0%,transparent 55%),radial-gradient(ellipse at 20% 80%,rgba(91,163,255,0.04) 0%,transparent 50%),var(--bg);display:flex;flex-direction:column;}
.landing-nav{display:flex;justify-content:space-between;align-items:center;padding:20px 22px;flex-shrink:0;}
.logo{font-family:'Playfair Display',serif;font-size:19px;font-weight:700;color:var(--gold2);}
.btn-login-nav{height:34px;padding:0 16px;border-radius:10px;border:1px solid var(--border2);background:transparent;color:var(--text2);font-size:12px;font-weight:600;cursor:pointer;font-family:'DM Sans',sans-serif;}
.landing-hero{flex:1;display:flex;flex-direction:column;justify-content:center;padding:20px 22px 30px;}
.hero-eyebrow{font-size:10px;font-weight:800;letter-spacing:.15em;text-transform:uppercase;color:var(--gold);margin-bottom:14px;opacity:.8;}
.hero-title{font-family:'Playfair Display',serif;font-size:38px;font-weight:700;line-height:1.15;margin-bottom:14px;}
.hero-title em{font-style:italic;color:var(--gold2);}
.hero-sub{font-size:14px;color:var(--text2);line-height:1.7;margin-bottom:32px;}
.btn-primary{height:52px;border-radius:14px;border:none;background:linear-gradient(135deg,var(--gold),var(--gold2));color:#080D14;font-size:15px;font-weight:800;cursor:pointer;font-family:'DM Sans',sans-serif;width:100%;margin-bottom:10px;}
.btn-secondary{height:52px;border-radius:14px;border:1.5px solid var(--border2);background:transparent;color:var(--text2);font-size:14px;font-weight:600;cursor:pointer;font-family:'DM Sans',sans-serif;width:100%;}
.landing-stats{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;padding:22px;border-top:1px solid var(--border);}
.ls-item{text-align:center;}
.ls-val{font-family:'Playfair Display',serif;font-size:22px;font-weight:600;color:var(--gold2);}
.ls-lbl{font-size:10px;color:var(--text3);margin-top:2px;text-transform:uppercase;letter-spacing:.05em;}
/* AUTH */
.auth-wrap{flex:1;display:flex;flex-direction:column;padding:20px 22px;}
.auth-back{display:flex;align-items:center;gap:6px;color:var(--text3);font-size:13px;cursor:pointer;margin-bottom:28px;background:none;border:none;font-family:'DM Sans',sans-serif;}
.auth-title{font-family:'Playfair Display',serif;font-size:28px;font-weight:600;margin-bottom:6px;}
.auth-sub{font-size:13px;color:var(--text2);margin-bottom:28px;line-height:1.6;}
.field-label{font-size:10px;font-weight:800;letter-spacing:.08em;text-transform:uppercase;color:var(--text3);margin-bottom:6px;}
.field-input{width:100%;height:46px;background:var(--card2);border:1px solid var(--border2);border-radius:12px;padding:0 14px;color:var(--text);font-size:14px;outline:none;font-family:'DM Sans',sans-serif;transition:border-color .15s;}
.field-input:focus{border-color:rgba(229,168,60,0.4);}
.field-wrap{margin-bottom:14px;}
.field-row{display:grid;grid-template-columns:1fr 1fr;gap:10px;}
.auth-switch{font-size:13px;color:var(--text2);text-align:center;margin-top:16px;}
.auth-switch span{color:var(--gold2);cursor:pointer;font-weight:600;}
/* SEARCH */
.search-header{background:var(--bg);border-bottom:1px solid var(--border);padding:16px 20px;flex-shrink:0;}
.search-header-top{display:flex;justify-content:space-between;align-items:center;margin-bottom:14px;}
.user-chip{display:flex;align-items:center;gap:7px;}
.user-av{width:30px;height:30px;border-radius:50%;background:rgba(229,168,60,0.12);border:1.5px solid rgba(229,168,60,0.3);display:flex;align-items:center;justify-content:center;font-size:11px;font-weight:700;color:var(--gold2);}
.user-name{font-size:13px;font-weight:600;}
.search-card{background:var(--card2);border:1px solid var(--border2);border-radius:18px;padding:18px;}
.route-row{display:flex;align-items:center;gap:8px;margin-bottom:12px;}
.airport-btn{flex:1;height:52px;background:var(--bg3);border:1px solid var(--border2);border-radius:12px;display:flex;flex-direction:column;justify-content:center;padding:0 12px;cursor:pointer;border:none;text-align:left;}
.ab-code{font-family:'DM Mono',monospace;font-size:20px;font-weight:700;color:var(--text);line-height:1;}
.ab-name{font-size:10px;color:var(--text3);margin-top:1px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.swap-btn{width:36px;height:36px;border-radius:10px;border:1px solid var(--border2);background:var(--bg3);color:var(--text2);font-size:16px;cursor:pointer;display:flex;align-items:center;justify-content:center;flex-shrink:0;}
.date-pax-row{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:14px;}
.dp-btn{height:46px;background:var(--bg3);border:1px solid var(--border2);border-radius:11px;display:flex;flex-direction:column;justify-content:center;padding:0 12px;cursor:pointer;border:none;text-align:left;}
.dp-lbl{font-size:9px;font-weight:800;letter-spacing:.07em;text-transform:uppercase;color:var(--text3);}
.dp-val{font-size:13px;font-weight:600;color:var(--text);margin-top:1px;}
.btn-search{height:50px;width:100%;border-radius:13px;border:none;background:linear-gradient(135deg,var(--gold),var(--gold2));color:#080D14;font-size:15px;font-weight:800;cursor:pointer;font-family:'DM Sans',sans-serif;}
/* AIRPORT SEARCH MODAL */
.modal-overlay{position:fixed;inset:0;background:rgba(7,9,15,0.92);backdrop-filter:blur(10px);z-index:100;display:none;flex-direction:column;padding:20px;}
.modal-overlay.open{display:flex;}
.modal-back{display:flex;align-items:center;gap:6px;color:var(--text3);font-size:13px;cursor:pointer;background:none;border:none;font-family:'DM Sans',sans-serif;margin-bottom:14px;}
.airport-search-inp{width:100%;height:50px;background:var(--card2);border:1.5px solid rgba(229,168,60,0.3);border-radius:14px;padding:0 16px;color:var(--text);font-size:16px;outline:none;font-family:'DM Sans',sans-serif;margin-bottom:12px;}
.airport-results{flex:1;overflow-y:auto;}
.ar-item{display:flex;align-items:center;gap:12px;padding:13px 14px;border:1px solid var(--border2);border-radius:12px;margin-bottom:8px;cursor:pointer;background:var(--card2);}
.ar-code{font-family:'DM Mono',monospace;font-size:16px;font-weight:700;color:var(--gold2);width:44px;flex-shrink:0;}
.ar-info{}
.ar-name{font-size:13px;font-weight:600;color:var(--text);}
.ar-city{font-size:11px;color:var(--text3);margin-top:1px;}
/* QUOTES/RESULTS */
.results-header{background:var(--bg);border-bottom:1px solid var(--border);padding:16px 20px 14px;flex-shrink:0;}
.rh-back{display:flex;align-items:center;gap:6px;color:var(--text3);font-size:13px;cursor:pointer;margin-bottom:12px;background:none;border:none;font-family:'DM Sans',sans-serif;}
.rh-route{font-family:'Playfair Display',serif;font-size:22px;font-weight:600;}
.rh-meta{font-size:12px;color:var(--text2);margin-top:3px;}
.rh-status{display:inline-flex;align-items:center;gap:5px;margin-top:8px;font-size:11px;font-weight:700;color:var(--orange);background:rgba(255,159,67,0.1);border:1px solid rgba(255,159,67,0.2);border-radius:8px;padding:4px 10px;}
.rh-status-dot{width:6px;height:6px;border-radius:50%;background:var(--orange);animation:breathe 1.5s ease-in-out infinite;}
@keyframes breathe{0%,100%{transform:scale(1)}50%{transform:scale(1.5);opacity:.5}}
.results-list{padding:16px;}
.quote-card{background:var(--card2);border:1px solid var(--border2);border-radius:18px;padding:18px;margin-bottom:14px;}
.qc-top{display:flex;align-items:flex-start;gap:12px;margin-bottom:14px;}
.qc-operator{font-size:11px;font-weight:700;color:var(--text3);text-transform:uppercase;letter-spacing:.06em;margin-bottom:3px;}
.qc-aircraft{font-size:16px;font-weight:700;color:var(--text);}
.qc-tail{font-family:'DM Mono',monospace;font-size:11px;color:var(--text3);margin-top:2px;}
.qc-price{margin-left:auto;text-align:right;}
.qc-amount{font-family:'Playfair Display',serif;font-size:26px;font-weight:600;color:var(--gold2);}
.qc-inc{font-size:10px;color:var(--text3);margin-top:2px;}
.qc-specs{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-bottom:14px;}
.qc-spec{background:var(--bg3);border-radius:9px;padding:9px 10px;text-align:center;}
.qs-val{font-size:13px;font-weight:700;}
.qs-lbl{font-size:9px;color:var(--text3);margin-top:2px;text-transform:uppercase;letter-spacing:.04em;}
.qc-eta{display:flex;align-items:center;gap:6px;font-size:12px;color:var(--text2);margin-bottom:14px;}
.qc-actions{display:flex;gap:8px;}
.btn-book{flex:2;height:44px;border-radius:11px;border:none;background:linear-gradient(135deg,var(--gold),var(--gold2));color:#080D14;font-size:13px;font-weight:800;cursor:pointer;font-family:'DM Sans',sans-serif;}
.btn-details{flex:1;height:44px;border-radius:11px;border:1px solid var(--border2);background:transparent;color:var(--text2);font-size:13px;cursor:pointer;font-family:'DM Sans',sans-serif;}
/* BOOKING FLOW */
.booking-nav{display:flex;align-items:center;justify-content:space-between;padding:16px 20px;border-bottom:1px solid var(--border);flex-shrink:0;}
.bnav-back{background:none;border:none;color:var(--text2);font-size:22px;cursor:pointer;}
.bnav-title{font-size:15px;font-weight:700;}
.bnav-step{font-size:12px;color:var(--text3);}
.progress-strip{height:2px;background:var(--border);flex-shrink:0;}
.progress-fill{height:100%;background:linear-gradient(90deg,var(--gold),var(--gold2));transition:width .3s ease;}
.booking-body{flex:1;overflow-y:auto;padding:20px;}
.section-title{font-size:11px;font-weight:800;letter-spacing:.08em;text-transform:uppercase;color:var(--text3);margin-bottom:12px;}
.booking-footer{padding:16px 20px;border-top:1px solid var(--border);flex-shrink:0;}
/* PASSENGER CARDS */
.pax-card{background:var(--card2);border:1px solid var(--border2);border-radius:14px;padding:14px;margin-bottom:10px;}
.pax-card-head{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;}
.pax-num{font-size:12px;font-weight:700;color:var(--gold2);}
.pax-remove{width:26px;height:26px;border-radius:7px;border:1px solid var(--border2);background:transparent;color:var(--red);font-size:12px;cursor:pointer;display:flex;align-items:center;justify-content:center;}
/* PREFERENCES */
.pref-option{display:flex;align-items:center;justify-content:space-between;background:var(--card2);border:1.5px solid var(--border2);border-radius:12px;padding:14px 16px;margin-bottom:8px;cursor:pointer;}
.pref-option.sel{border-color:rgba(229,168,60,0.4);background:rgba(229,168,60,0.05);}
.po-title{font-size:14px;font-weight:600;}
.po-desc{font-size:11px;color:var(--text2);margin-top:2px;}
.po-price{font-size:13px;font-weight:700;color:var(--gold2);}
/* PAYMENT SUMMARY */
.payment-line{display:flex;justify-content:space-between;align-items:center;padding:10px 0;border-bottom:1px solid rgba(255,255,255,0.04);font-size:13px;}
.payment-line:last-child{border-bottom:none;}
.pl-label{color:var(--text2);}
.pl-val{font-weight:600;}
.total-line{display:flex;justify-content:space-between;align-items:center;padding:14px 0 0;font-size:16px;font-weight:800;border-top:1px solid var(--border2);}
.total-val{font-family:'Playfair Display',serif;font-size:26px;font-weight:600;color:var(--gold2);}
.card-field-wrap{background:var(--card2);border:1px solid var(--border2);border-radius:14px;padding:16px;margin-bottom:10px;}
.card-row{display:flex;gap:10px;}
/* TRIPS DASHBOARD */
.trips-header{background:var(--bg);border-bottom:1px solid var(--border);padding:16px 20px;flex-shrink:0;}
.trips-tabs{display:flex;gap:4px;background:var(--bg3);border-radius:10px;padding:3px;margin-top:12px;}
.tt-btn{flex:1;padding:7px;border-radius:8px;font-size:12px;font-weight:600;color:var(--text3);cursor:pointer;text-align:center;}
.tt-btn.active{background:var(--card2);color:var(--gold2);}
.trip-card{background:var(--card2);border:1px solid var(--border2);border-radius:16px;padding:16px;margin-bottom:12px;}
.tc-route{font-family:'Playfair Display',serif;font-size:20px;font-weight:600;margin-bottom:3px;}
.tc-meta{font-size:12px;color:var(--text2);}
.tc-status{display:inline-flex;align-items:center;gap:5px;margin-top:8px;font-size:10px;font-weight:800;padding:3px 9px;border-radius:7px;}
.tc-st-upcoming{background:rgba(91,163,255,0.1);color:var(--blue);}
.tc-st-completed{background:rgba(79,208,128,0.1);color:var(--green);}
.tc-st-pending{background:rgba(255,159,67,0.1);color:var(--orange);}
.tc-footer{display:flex;justify-content:space-between;align-items:center;margin-top:12px;padding-top:12px;border-top:1px solid rgba(255,255,255,0.04);}
.tc-aircraft{font-size:12px;color:var(--text3);}
.tc-price{font-family:'DM Mono',monospace;font-size:14px;font-weight:700;color:var(--gold2);}
/* BOTTOM NAV */
.bottom-nav{display:flex;border-top:1px solid var(--border);background:var(--bg);flex-shrink:0;}
.bn-i{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:10px 0;cursor:pointer;gap:3px;}
.bn-i.active .bn-ic{color:var(--gold2);}
.bn-i.active .bn-lb{color:var(--gold2);}
.bn-ic{font-size:19px;color:var(--text3);}
.bn-lb{font-size:9px;font-weight:700;letter-spacing:.06em;text-transform:uppercase;color:var(--text3);}
/* TOAST */
.toast{position:fixed;top:70px;left:50%;transform:translateX(-50%) translateY(-16px);background:var(--card2);border:1px solid var(--border2);border-radius:12px;padding:11px 16px;display:flex;align-items:center;gap:9px;z-index:500;opacity:0;transition:all .2s;white-space:nowrap;pointer-events:none;}
.toast.show{opacity:1;transform:translateX(-50%) translateY(0);}
select.field-input{appearance:none;}
</style>
</head>
<body>

<!-- ════════════════════════════════════════════
     LANDING
════════════════════════════════════════════ -->
<div id="v-landing" class="view active">
  <div class="landing-bg">
    <nav class="landing-nav">
      <div class="logo">Aviate Atelier</div>
      <button class="btn-login-nav" onclick="showView('v-login')">Sign In</button>
    </nav>
    <div class="landing-hero">
      <div class="hero-eyebrow">Private Charter, Reimagined</div>
      <div class="hero-title">Charter Without<br><em>Complexity.</em></div>
      <div class="hero-sub">Access a curated network of FAA Part 135 certified operators. Instant quotes, transparent pricing, seamless booking.</div>
      <button class="btn-primary" onclick="showView('v-signup')">Get Started — It's Free</button>
      <button class="btn-secondary" onclick="showView('v-login')">I already have an account</button>
    </div>
    <div class="landing-stats">
      <div class="ls-item"><div class="ls-val">339+</div><div class="ls-lbl">Airports</div></div>
      <div class="ls-item"><div class="ls-val">241</div><div class="ls-lbl">Aircraft Types</div></div>
      <div class="ls-item"><div class="ls-val">Part 135</div><div class="ls-lbl">Certified Only</div></div>
    </div>
  </div>
</div>

<!-- ════════════════════════════════════════════
     LOGIN
════════════════════════════════════════════ -->
<div id="v-login" class="view">
  <div class="auth-wrap">
    <button class="auth-back" onclick="showView('v-landing')">&#x2190; Back</button>
    <div class="auth-title">Welcome Back</div>
    <div class="auth-sub">Sign in to access your charter account and manage your upcoming flights.</div>
    <div class="field-wrap"><div class="field-label">Email Address</div><input class="field-input" type="email" id="login-email" placeholder="your@email.com"></div>
    <div class="field-wrap"><div class="field-label">Password</div><input class="field-input" type="password" id="login-pw" placeholder="&#x2022;&#x2022;&#x2022;&#x2022;&#x2022;&#x2022;&#x2022;&#x2022;"></div>
    <div style="text-align:right;margin-bottom:24px;"><span style="font-size:12px;color:var(--gold2);cursor:pointer;">Forgot password?</span></div>
    <button class="btn-primary" onclick="handleLogin()">Sign In</button>
    <div class="auth-switch">Don't have an account? <span onclick="showView('v-signup')">Create one</span></div>
  </div>
</div>

<!-- ════════════════════════════════════════════
     SIGNUP
════════════════════════════════════════════ -->
<div id="v-signup" class="view">
  <div class="auth-wrap">
    <button class="auth-back" onclick="showView('v-landing')">&#x2190; Back</button>
    <div class="auth-title">Create Account</div>
    <div class="auth-sub">Join Aviate Atelier and access a curated network of Part 135 certified operators.</div>
    <div class="field-row">
      <div class="field-wrap"><div class="field-label">First Name</div><input class="field-input" type="text" id="su-first" placeholder="James"></div>
      <div class="field-wrap"><div class="field-label">Last Name</div><input class="field-input" type="text" id="su-last" placeholder="Whitfield"></div>
    </div>
    <div class="field-wrap"><div class="field-label">Email Address</div><input class="field-input" type="email" id="su-email" placeholder="your@email.com"></div>
    <div class="field-wrap"><div class="field-label">Phone Number</div><input class="field-input" type="tel" id="su-phone" placeholder="+1 (305) 555 0100"></div>
    <div class="field-wrap"><div class="field-label">Password</div><input class="field-input" type="password" id="su-pw" placeholder="Min. 8 characters"></div>
    <button class="btn-primary" style="margin-top:8px;" onclick="handleSignup()">Create Account</button>
    <div class="auth-switch">Already have an account? <span onclick="showView('v-login')">Sign In</span></div>
  </div>
</div>

<!-- ════════════════════════════════════════════
     MAIN APP (after login)
════════════════════════════════════════════ -->
<div id="v-app" class="view" style="flex-direction:column;">

  <!-- SEARCH SCREEN -->
  <div id="app-search" style="flex:1;overflow-y:auto;display:flex;flex-direction:column;">
    <div class="search-header">
      <div class="search-header-top">
        <div><div style="font-family:'Playfair Display',serif;font-size:20px;font-weight:600;">Good morning,</div><div style="font-size:13px;color:var(--text2);margin-top:1px;" id="user-greeting-name">traveller.</div></div>
        <div class="user-chip"><div class="user-av" id="user-av-initials">JW</div></div>
      </div>
      <div class="search-card">
        <div class="route-row">
          <button class="airport-btn" onclick="openAirportModal('from')">
            <div class="ab-code" id="from-code">OPF</div>
            <div class="ab-name" id="from-name">Miami Opa Locka</div>
          </button>
          <button class="swap-btn" onclick="swapAirports()">&#x21C4;</button>
          <button class="airport-btn" onclick="openAirportModal('to')">
            <div class="ab-code" id="to-code">TEB</div>
            <div class="ab-name" id="to-name">Teterboro</div>
          </button>
        </div>
        <div class="date-pax-row">
          <button class="dp-btn">
            <div class="dp-lbl">Date</div>
            <input id="flight-date" type="date" style="background:transparent;border:none;color:var(--text);font-family:'DM Sans',sans-serif;font-size:13px;font-weight:600;outline:none;cursor:pointer;width:100%;">
          </button>
          <button class="dp-btn" style="cursor:default;">
            <div class="dp-lbl">Passengers</div>
            <div style="display:flex;align-items:center;gap:8px;margin-top:1px;">
              <span onclick="adjPax(-1)" style="width:22px;height:22px;border-radius:6px;background:var(--bg2);display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:14px;border:1px solid var(--border2);">&#x2212;</span>
              <span id="pax-count" style="font-size:14px;font-weight:700;">4</span>
              <span onclick="adjPax(1)" style="width:22px;height:22px;border-radius:6px;background:var(--bg2);display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:14px;border:1px solid var(--border2);">+</span>
            </div>
          </button>
        </div>
        <button class="btn-search" onclick="searchFlights()">Search Available Aircraft &#x2192;</button>
      </div>
    </div>

    <!-- Recent / Featured -->
    <div style="padding:18px 18px 8px;">
      <div style="font-size:11px;font-weight:800;letter-spacing:.07em;text-transform:uppercase;color:var(--text3);margin-bottom:12px;">Popular Routes</div>
      <div style="display:flex;flex-direction:column;gap:8px;">
        <div onclick="quickRoute('MIA','TEB','Miami Int\'l','Teterboro')" style="background:var(--card2);border:1px solid var(--border2);border-radius:13px;padding:13px 15px;display:flex;justify-content:space-between;align-items:center;cursor:pointer;">
          <div><div style="font-size:14px;font-weight:700;">MIA &#x2192; TEB</div><div style="font-size:11px;color:var(--text3);margin-top:2px;">Miami to Teterboro &middot; ~2.5 hrs</div></div>
          <div style="font-size:13px;color:var(--gold2);font-weight:700;">From $18,500</div>
        </div>
        <div onclick="quickRoute('VNY','ASE','Van Nuys','Aspen')" style="background:var(--card2);border:1px solid var(--border2);border-radius:13px;padding:13px 15px;display:flex;justify-content:space-between;align-items:center;cursor:pointer;">
          <div><div style="font-size:14px;font-weight:700;">VNY &#x2192; ASE</div><div style="font-size:11px;color:var(--text3);margin-top:2px;">Van Nuys to Aspen &middot; ~1.5 hrs</div></div>
          <div style="font-size:13px;color:var(--gold2);font-weight:700;">From $12,200</div>
        </div>
        <div onclick="quickRoute('HOU','SJD','Houston Hobby','Los Cabos')" style="background:var(--card2);border:1px solid var(--border2);border-radius:13px;padding:13px 15px;display:flex;justify-content:space-between;align-items:center;cursor:pointer;">
          <div><div style="font-size:14px;font-weight:700;">HOU &#x2192; SJD</div><div style="font-size:11px;color:var(--text3);margin-top:2px;">Houston to Los Cabos &middot; ~2 hrs</div></div>
          <div style="font-size:13px;color:var(--gold2);font-weight:700;">From $24,800</div>
        </div>
      </div>
    </div>
    <div style="height:12px;"></div>
  </div>

  <!-- RESULTS SCREEN -->
  <div id="app-results" style="display:none;flex:1;overflow-y:auto;flex-direction:column;">
    <div class="results-header">
      <button class="rh-back" onclick="showAppScreen('search')">&#x2190; New Search</button>
      <div class="rh-route" id="results-route">MIA &#x2192; TEB</div>
      <div class="rh-meta" id="results-meta">Mar 15, 2026 &middot; 4 passengers</div>
      <div class="rh-status"><span class="rh-status-dot"></span>Requesting quotes from operators...</div>
    </div>
    <div class="results-list" id="results-list"></div>
  </div>

  <!-- BOOKING FLOW SCREEN -->
  <div id="app-booking" style="display:none;flex:1;flex-direction:column;overflow:hidden;">
    <div class="booking-nav">
      <button class="bnav-back" onclick="bookingBack()">&#x2190;</button>
      <div class="bnav-title" id="booking-step-title">Passenger Details</div>
      <div class="bnav-step" id="booking-step-num">Step 1 of 3</div>
    </div>
    <div class="progress-strip"><div class="progress-fill" id="booking-progress" style="width:33%"></div></div>
    <div class="booking-body" id="booking-body"></div>
    <div class="booking-footer">
      <button class="btn-primary" id="booking-next-btn" onclick="bookingNext()">Continue &#x2192;</button>
    </div>
  </div>

  <!-- TRIPS SCREEN -->
  <div id="app-trips" style="display:none;flex:1;overflow-y:auto;flex-direction:column;">
    <div class="trips-header">
      <div style="font-family:'Playfair Display',serif;font-size:22px;font-weight:600;">My Trips</div>
      <div class="trips-tabs">
        <div class="tt-btn active" onclick="filterTrips('upcoming',this)">Upcoming</div>
        <div class="tt-btn" onclick="filterTrips('pending',this)">Pending Quotes</div>
        <div class="tt-btn" onclick="filterTrips('completed',this)">Completed</div>
      </div>
    </div>
    <div id="trips-list" style="padding:16px;"></div>
  </div>

  <!-- ACCOUNT SCREEN -->
  <div id="app-account" style="display:none;flex:1;overflow-y:auto;padding:20px;">
    <div style="font-family:'Playfair Display',serif;font-size:24px;font-weight:600;margin-bottom:20px;">My Account</div>
    <div style="background:var(--card2);border:1px solid var(--border2);border-radius:18px;padding:20px;margin-bottom:14px;text-align:center;">
      <div style="width:64px;height:64px;border-radius:18px;background:rgba(229,168,60,0.12);border:2px solid rgba(229,168,60,0.3);display:flex;align-items:center;justify-content:center;font-size:24px;font-weight:700;color:var(--gold2);margin:0 auto 12px;" id="acct-avatar">JW</div>
      <div style="font-family:'Playfair Display',serif;font-size:20px;font-weight:600;" id="acct-name">James Whitfield</div>
      <div style="font-size:13px;color:var(--text2);margin-top:3px;" id="acct-email">james@email.com</div>
    </div>
    <div style="background:var(--card2);border:1px solid var(--border2);border-radius:16px;overflow:hidden;margin-bottom:14px;">
      <div onclick="" style="display:flex;align-items:center;justify-content:space-between;padding:15px 17px;border-bottom:1px solid var(--border);cursor:pointer;"><span style="font-size:14px;font-weight:600;">Edit Profile</span><span style="color:var(--text3);">&#x276F;</span></div>
      <div onclick="" style="display:flex;align-items:center;justify-content:space-between;padding:15px 17px;border-bottom:1px solid var(--border);cursor:pointer;"><span style="font-size:14px;font-weight:600;">Payment Methods</span><span style="color:var(--text3);">&#x276F;</span></div>
      <div onclick="" style="display:flex;align-items:center;justify-content:space-between;padding:15px 17px;cursor:pointer;"><span style="font-size:14px;font-weight:600;">Notification Preferences</span><span style="color:var(--text3);">&#x276F;</span></div>
    </div>
    <button onclick="handleLogout()" style="width:100%;height:46px;border-radius:13px;border:1px solid rgba(255,94,94,0.25);background:rgba(255,94,94,0.05);color:var(--red);font-size:14px;font-weight:600;cursor:pointer;font-family:'DM Sans',sans-serif;">Sign Out</button>
  </div>

  <!-- BOTTOM NAV -->
  <div class="bottom-nav" id="app-bottom-nav">
    <div class="bn-i active" onclick="switchAppTab('search',this)"><div class="bn-ic">&#x1F50D;</div><div class="bn-lb">Search</div></div>
    <div class="bn-i" onclick="switchAppTab('trips',this)"><div class="bn-ic">&#x2708;</div><div class="bn-lb">My Trips</div></div>
    <div class="bn-i" onclick="switchAppTab('account',this)"><div class="bn-ic">&#x1F464;</div><div class="bn-lb">Account</div></div>
  </div>
</div>

<!-- AIRPORT MODAL -->
<div class="modal-overlay" id="airport-modal">
  <button class="modal-back" onclick="closeAirportModal()">&#x2190; Back</button>
  <div style="font-size:18px;font-weight:700;margin-bottom:14px;" id="airport-modal-title">From Airport</div>
  <input class="airport-search-inp" id="airport-search-inp" placeholder="Search by city, airport or code..." oninput="searchAirports(this.value)" autofocus>
  <div class="airport-results" id="airport-results"></div>
</div>

<!-- TOAST -->
<div class="toast" id="toast"><span id="toast-ico">&#x2713;</span><div><div id="toast-msg" style="font-size:13px;font-weight:700;"></div><div id="toast-sub" style="font-size:11px;color:var(--text3);margin-top:1px;"></div></div></div>

<script>
// ── SUPABASE CLIENT ──
const _sb = supabase.createClient(
  'https://hkjldgjvxgrutnqzwfql.supabase.co',
  'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImhramxkZ2p2eGdydXRucXp3ZnFsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzIwNDMwOTYsImV4cCI6MjA4NzYxOTA5Nn0.aNICtFHRMeP5Xu9ssgLlziC6cbR6-WXcTCbM1UY1q3g'
);
var _user = null;
var _clientRecord = null;

// Check if already logged in on load
(async function checkSession() {
  const { data: { session } } = await _sb.auth.getSession();
  if (session) {
    const { data: client } = await _sb.from('clients').select('*').eq('user_id', session.user.id).single();
    if (client) {
      _user = { firstName: client.first_name, lastName: client.last_name, email: client.email, initials: (client.first_name[0] + client.last_name[0]).toUpperCase() };
      _clientRecord = client;
      enterApp();
    }
  }
})();

// ── AIRPORTS (sample — full list will be injected from worldwide_airports.js) ──
var AIRPORTS = [
  {code:'OPF',name:'Miami Opa Locka Executive',city:'Miami, FL'},{code:'MIA',name:'Miami International',city:'Miami, FL'},
  {code:'TEB',name:'Teterboro Airport',city:'Teterboro, NJ'},{code:'JFK',name:'John F. Kennedy Intl',city:'New York, NY'},
  {code:'KLAX',name:'Los Angeles International',city:'Los Angeles, CA'},{code:'VNY',name:'Van Nuys Airport',city:'Los Angeles, CA'},
  {code:'ASE',name:'Aspen/Pitkin County',city:'Aspen, CO'},{code:'DEN',name:'Denver International',city:'Denver, CO'},
  {code:'HOU',name:'William P. Hobby',city:'Houston, TX'},{code:'SJD',name:'Los Cabos International',city:'Los Cabos, MX'},
  {code:'LAX',name:'Los Angeles International',city:'Los Angeles, CA'},{code:'ORD',name:'O\'Hare International',city:'Chicago, IL'},
  {code:'ATL',name:'Hartsfield-Jackson',city:'Atlanta, GA'},{code:'LAS',name:'Harry Reid International',city:'Las Vegas, NV'},
  {code:'SFO',name:'San Francisco International',city:'San Francisco, CA'},{code:'BOS',name:'Logan International',city:'Boston, MA'},
  {code:'MCO',name:'Orlando International',city:'Orlando, FL'},{code:'DFW',name:'Dallas/Fort Worth Intl',city:'Dallas, TX'},
  {code:'KDAL',name:'Love Field',city:'Dallas, TX'},{code:'SDC',name:'Sheridan County',city:'Sheridan, WY'},
  {code:'ADS',name:'Addison Airport',city:'Dallas, TX'},{code:'PDK',name:'DeKalb-Peachtree',city:'Atlanta, GA'},
  {code:'SMF',name:'Sacramento International',city:'Sacramento, CA'},{code:'SNA',name:'John Wayne Airport',city:'Orange County, CA'},
];

// ── MOCK QUOTES ──
var MOCK_QUOTES = [
  {operator:'Apex Air Charter',aircraft:'Gulfstream G550',tail:'N481SP',price:28500,pax:8,speed:500,range:'3,500 nm',flightTime:'2h 40m',cat:'heavy'},
  {operator:'Summit Jets',aircraft:'Bombardier Challenger 350',tail:'N720SJ',price:18200,pax:8,speed:470,range:'3,200 nm',flightTime:'2h 55m',cat:'super-midsize'},
  {operator:'Meridian Air',aircraft:'Gulfstream G450',tail:'N450MA',price:22800,pax:7,speed:490,range:'4,000 nm',flightTime:'2h 45m',cat:'heavy'},
  {operator:'Coastal Charter',aircraft:'Embraer Legacy 600',tail:'N600CC',price:16400,pax:7,speed:450,range:'3,200 nm',flightTime:'3h 05m',cat:'large'},
];

// ── MOCK TRIPS ──
var MOCK_TRIPS = {
  upcoming: [
    {route:'OPF &#x2192; TEB',aircraft:'Gulfstream G550',date:'Mar 15, 2026',pax:4,price:'$28,500',status:'upcoming'},
    {route:'ADS &#x2192; SJD',aircraft:'Challenger 350',date:'Mar 28, 2026',pax:6,price:'$19,200',status:'upcoming'},
  ],
  pending: [
    {route:'VNY &#x2192; ASE',aircraft:'Awaiting quotes',date:'Apr 3, 2026',pax:3,price:'—',status:'pending'},
  ],
  completed: [
    {route:'MIA &#x2192; TEB',aircraft:'G450',date:'Feb 10, 2026',pax:5,price:'$22,800',status:'completed'},
    {route:'HOU &#x2192; SJD',aircraft:'Legacy 600',date:'Jan 28, 2026',pax:4,price:'$16,400',status:'completed'},
  ]
};

// ─── STATE ───
var _fromAirport = {code:'OPF', name:'Miami Opa Locka'};
var _toAirport   = {code:'TEB', name:'Teterboro'};
var _passengers  = 4;
var _modalTarget = 'from';
var _bookingStep = 1;
var _selectedQuote = null;
var _passengerForms = [];

// ── NAVIGATION ──
function showView(id) {
  document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}
function showAppScreen(name) {
  var screens = ['search','results','booking','trips','account'];
  screens.forEach(function(s) {
    var el = document.getElementById('app-' + s);
    if (el) el.style.display = (s === name) ? (s === 'booking' ? 'flex' : 'flex') : 'none';
  });
  // Show/hide bottom nav
  var nav = document.getElementById('app-bottom-nav');
  nav.style.display = (name === 'booking') ? 'none' : 'flex';
}
function switchAppTab(name, el) {
  document.querySelectorAll('.bn-i').forEach(b => b.classList.remove('active'));
  if (el) el.classList.add('active');
  showAppScreen(name);
  if (name === 'trips') loadTrips('upcoming');
}

// ── AUTH ──
async function handleLogin() {
  var email = document.getElementById('login-email').value.trim();
  var pw    = document.getElementById('login-pw').value;
  if (!email || !pw) { showToast('⚠','Required fields missing','Please enter email and password'); return; }
  showToast('⌛','Signing in...','');
  const { data, error } = await _sb.auth.signInWithPassword({ email, password: pw });
  if (error) { showToast('⚠','Sign in failed', error.message); return; }
  const { data: client } = await _sb.from('clients').select('*').eq('user_id', data.user.id).single();
  if (!client) { showToast('⚠','Account not found','No client account linked to this email'); return; }
  _user = { firstName: client.first_name, lastName: client.last_name, email: client.email, initials: (client.first_name[0] + client.last_name[0]).toUpperCase() };
  _clientRecord = client;
  enterApp();
}
async function handleSignup() {
  var first = document.getElementById('su-first').value.trim();
  var last  = document.getElementById('su-last').value.trim();
  var email = document.getElementById('su-email').value.trim();
  var phone = document.getElementById('su-phone').value.trim();
  var pw    = document.getElementById('su-pw').value;
  if (!first || !email || !pw) { showToast('⚠','Required fields missing','Fill in all required fields'); return; }
  if (pw.length < 8) { showToast('⚠','Password too short','Minimum 8 characters'); return; }
  showToast('⌛','Creating account...','');
  const { data, error } = await _sb.auth.signUp({ email, password: pw });
  if (error) { showToast('⚠','Sign up failed', error.message); return; }
  // Insert into clients table
  const { data: client, error: clientError } = await _sb.from('clients').insert({
    user_id: data.user.id,
    first_name: first,
    last_name: last || '',
    email: email,
    phone: phone || null,
  }).select().single();
  if (clientError) { showToast('⚠','Profile error', clientError.message); return; }
  _user = { firstName: first, lastName: last, email: email, initials: (first[0] + (last ? last[0] : '')).toUpperCase() };
  _clientRecord = client;
  showToast('✓','Account created!','Welcome to Aviate Atelier');
  enterApp();
}
function enterApp() {
  document.getElementById('user-greeting-name').textContent = _user.firstName + '.';
  document.getElementById('user-av-initials').textContent = _user.initials;
  document.getElementById('acct-avatar').textContent = _user.initials;
  document.getElementById('acct-name').textContent = _user.firstName + ' ' + _user.lastName;
  document.getElementById('acct-email').textContent = _user.email;
  showView('v-app');
  showAppScreen('search');
  // Set default date to tomorrow
  var d = new Date(); d.setDate(d.getDate() + 1);
  document.getElementById('flight-date').value = d.toISOString().split('T')[0];
}
async function handleLogout() {
  await _sb.auth.signOut();
  _user = null;
  _clientRecord = null;
  showView('v-landing');
}

// ── AIRPORT SEARCH ──
function openAirportModal(target) {
  _modalTarget = target;
  document.getElementById('airport-modal-title').textContent = target === 'from' ? 'Departure Airport' : 'Destination Airport';
  document.getElementById('airport-search-inp').value = '';
  renderAirportResults(AIRPORTS.slice(0, 12));
  document.getElementById('airport-modal').classList.add('open');
  setTimeout(function(){ document.getElementById('airport-search-inp').focus(); }, 100);
}
function closeAirportModal() {
  document.getElementById('airport-modal').classList.remove('open');
}
function searchAirports(q) {
  if (!q) { renderAirportResults(AIRPORTS.slice(0,12)); return; }
  q = q.toLowerCase();
  var res = AIRPORTS.filter(function(a){
    return a.code.toLowerCase().indexOf(q) >= 0 || a.name.toLowerCase().indexOf(q) >= 0 || a.city.toLowerCase().indexOf(q) >= 0;
  }).slice(0,12);
  renderAirportResults(res);
}
function renderAirportResults(airports) {
  var html = '';
  for (var i=0; i < airports.length; i++) {
    var a = airports[i];
    html += '<div class="ar-item" onclick="selectAirport(\'' + a.code + "','" + a.name + "','" + a.city + '\')">' +
      '<div class="ar-code">' + a.code + '</div>' +
      '<div class="ar-info"><div class="ar-name">' + a.name + '</div><div class="ar-city">' + a.city + '</div></div>' +
    '</div>';
  }
  document.getElementById('airport-results').innerHTML = html || '<div style="text-align:center;padding:30px;color:var(--text3);">No airports found</div>';
}
function selectAirport(code, name, city) {
  if (_modalTarget === 'from') {
    _fromAirport = {code:code, name:name};
    document.getElementById('from-code').textContent = code;
    document.getElementById('from-name').textContent = name;
  } else {
    _toAirport = {code:code, name:name};
    document.getElementById('to-code').textContent = code;
    document.getElementById('to-name').textContent = name;
  }
  closeAirportModal();
}
function swapAirports() {
  var tmp = _fromAirport;
  _fromAirport = _toAirport;
  _toAirport = tmp;
  document.getElementById('from-code').textContent = _fromAirport.code;
  document.getElementById('from-name').textContent = _fromAirport.name;
  document.getElementById('to-code').textContent = _toAirport.code;
  document.getElementById('to-name').textContent = _toAirport.name;
}
function adjPax(d) {
  _passengers = Math.max(1, Math.min(14, _passengers + d));
  document.getElementById('pax-count').textContent = _passengers;
}
function quickRoute(fc, tc, fn, tn) {
  _fromAirport = {code:fc, name:fn};
  _toAirport   = {code:tc, name:tn};
  document.getElementById('from-code').textContent = fc;
  document.getElementById('from-name').textContent = fn;
  document.getElementById('to-code').textContent = tc;
  document.getElementById('to-name').textContent = tn;
  searchFlights();
}

// ── SEARCH & RESULTS ──
function searchFlights() {
  var date = document.getElementById('flight-date').value;
  if (!date) { showToast('&#x26A0;','Select a date','Please choose a departure date'); return; }
  document.getElementById('results-route').innerHTML = _fromAirport.code + ' &#x2192; ' + _toAirport.code;
  var d = new Date(date);
  var opts = {year:'numeric',month:'short',day:'numeric'};
  document.getElementById('results-meta').textContent = d.toLocaleDateString('en-US',opts) + ' \u00b7 ' + _passengers + ' passenger' + (_passengers>1?'s':'');
  showAppScreen('results');
  document.getElementById('results-list').innerHTML = '<div style="text-align:center;padding:40px;color:var(--text3);"><div style="font-size:28px;margin-bottom:8px;">&#x231B;</div>Requesting quotes from operators...</div>';
  // Save booking request to Supabase if logged in
  if (_clientRecord) {
    _sb.from('booking_requests').insert({
      client_id: _clientRecord.id,
      from_airport: _fromAirport.code,
      from_city: _fromAirport.name,
      to_airport: _toAirport.code,
      to_city: _toAirport.name,
      flight_date: date,
      passengers: _passengers,
      status: 'open'
    }).then(function(res) {
      if (res.error) console.warn('Booking request save:', res.error.message);
    });
  }
  setTimeout(renderMockQuotes, 1800);
}
function renderMockQuotes() {
  var html = '';
  for (var i=0; i < MOCK_QUOTES.length; i++) {
    var q = MOCK_QUOTES[i];
    html += '<div class="quote-card">' +
      '<div class="qc-top">' +
        '<div>' +
          '<div class="qc-operator">' + q.operator + '</div>' +
          '<div class="qc-aircraft">' + q.aircraft + '</div>' +
          '<div class="qc-tail">' + q.tail + '</div>' +
        '</div>' +
        '<div class="qc-price">' +
          '<div class="qc-amount">$' + q.price.toLocaleString() + '</div>' +
          '<div class="qc-inc">All-in · No hidden fees</div>' +
        '</div>' +
      '</div>' +
      '<div class="qc-specs">' +
        '<div class="qc-spec"><div class="qs-val">' + q.pax + '</div><div class="qs-lbl">Max Pax</div></div>' +
        '<div class="qc-spec"><div class="qs-val">' + q.flightTime + '</div><div class="qs-lbl">Est. Time</div></div>' +
        '<div class="qc-spec"><div class="qs-val">' + q.range + '</div><div class="qs-lbl">Range</div></div>' +
      '</div>' +
      '<div class="qc-actions">' +
        '<button class="btn-details">Details</button>' +
        '<button class="btn-book" onclick="startBooking(' + i + ')">Book This Flight &#x2192;</button>' +
      '</div>' +
    '</div>';
  }
  document.getElementById('results-list').innerHTML = html;
}

// ── BOOKING FLOW ──
function startBooking(idx) {
  _selectedQuote = MOCK_QUOTES[idx];
  _bookingStep = 1;
  _passengerForms = [];
  for (var i=0; i < _passengers; i++) _passengerForms.push({});
  renderBookingStep();
  showAppScreen('booking');
}
function renderBookingStep() {
  var titles = ['Passenger Details','Preferences & Services','Review & Confirm'];
  var progrs = ['33%','66%','100%'];
  document.getElementById('booking-step-title').textContent = titles[_bookingStep - 1];
  document.getElementById('booking-step-num').textContent = 'Step ' + _bookingStep + ' of 3';
  document.getElementById('booking-progress').style.width = progrs[_bookingStep - 1];
  var btn = document.getElementById('booking-next-btn');
  btn.textContent = _bookingStep < 3 ? 'Continue \u2192' : 'Confirm & Pay';

  if (_bookingStep === 1) renderPassengerStep();
  else if (_bookingStep === 2) renderPreferencesStep();
  else renderConfirmStep();
}
function renderPassengerStep() {
  var html = '<div class="section-title">Passenger Information</div>';
  for (var i=0; i < _passengers; i++) {
    var lbl = i === 0 ? 'Lead Passenger (You)' : 'Passenger ' + (i+1);
    html += '<div class="pax-card">' +
      '<div class="pax-card-head"><span class="pax-num">' + lbl + '</span>' +
      (i > 0 ? '<button class="pax-remove" onclick="removePax(' + i + ')">&#x2715;</button>' : '') +
      '</div>' +
      '<div class="field-row">' +
        '<div class="field-wrap"><div class="field-label">First Name</div><input class="field-input" id="pf-' + i + '-first" placeholder="First"></div>' +
        '<div class="field-wrap"><div class="field-label">Last Name</div><input class="field-input" id="pf-' + i + '-last" placeholder="Last"></div>' +
      '</div>' +
      '<div class="field-row">' +
        '<div class="field-wrap"><div class="field-label">Date of Birth</div><input class="field-input" type="date" id="pf-' + i + '-dob"></div>' +
        '<div class="field-wrap"><div class="field-label">Passport / ID</div><input class="field-input" id="pf-' + i + '-doc" placeholder="Number"></div>' +
      '</div>' +
    '</div>';
  }
  html += '<button onclick="addPax()" style="width:100%;height:42px;border-radius:11px;border:1.5px dashed var(--border2);background:transparent;color:var(--text3);font-size:13px;cursor:pointer;font-family:\'DM Sans\',sans-serif;margin-top:4px;">+ Add Passenger</button>';
  document.getElementById('booking-body').innerHTML = html;
}
function renderPreferencesStep() {
  var html = '<div class="section-title" style="margin-bottom:14px;">Catering</div>';
  var catering = [
    {id:'none',title:'No Catering',desc:'Beverages only',price:'Included'},
    {id:'light',title:'Light Refreshments',desc:'Charcuterie, fresh fruit, pastries',price:'+$450'},
    {id:'full',title:'Full Catering',desc:'Custom menu, plated meals, premium bar',price:'+$1,200'},
  ];
  for (var i=0; i < catering.length; i++) {
    var c = catering[i];
    html += '<div class="pref-option' + (i===0?' sel':'') + '" onclick="selPref(this,\'catering\')" data-val="' + c.id + '">' +
      '<div><div class="po-title">' + c.title + '</div><div class="po-desc">' + c.desc + '</div></div>' +
      '<div class="po-price">' + c.price + '</div></div>';
  }
  html += '<div class="section-title" style="margin-top:20px;margin-bottom:14px;">Ground Transport</div>';
  var transport = [
    {id:'none',title:'No Transfer',desc:'Own arrangement',price:'—'},
    {id:'suv',title:'Luxury SUV',desc:'Black SUV to/from FBO',price:'+$280'},
    {id:'sedan',title:'Executive Sedan',desc:'Town car service',price:'+$180'},
  ];
  for (var j=0; j < transport.length; j++) {
    var t = transport[j];
    html += '<div class="pref-option' + (j===0?' sel':'') + '" onclick="selPref(this,\'transport\')" data-val="' + t.id + '">' +
      '<div><div class="po-title">' + t.title + '</div><div class="po-desc">' + t.desc + '</div></div>' +
      '<div class="po-price">' + t.price + '</div></div>';
  }
  html += '<div style="margin-top:16px;"><div class="field-label" style="margin-bottom:6px;">Special Requests (Optional)</div><textarea class="field-input" style="height:80px;padding:12px;resize:none;line-height:1.5;" placeholder="Dietary restrictions, onboard preferences, special occasions..."></textarea></div>';
  document.getElementById('booking-body').innerHTML = html;
}
function renderConfirmStep() {
  if (!_selectedQuote) return;
  var q = _selectedQuote;
  var html =
    '<div class="section-title">Flight Summary</div>' +
    '<div style="background:var(--card2);border:1px solid var(--border2);border-radius:14px;padding:16px;margin-bottom:16px;">' +
      '<div style="font-size:13px;font-weight:700;color:var(--text2);margin-bottom:3px;">' + q.operator + '</div>' +
      '<div style="font-family:\'Playfair Display\',serif;font-size:22px;font-weight:600;margin-bottom:2px;">' + _fromAirport.code + ' &#x2192; ' + _toAirport.code + '</div>' +
      '<div style="font-size:12px;color:var(--text3);">' + q.aircraft + ' &middot; ' + q.tail + ' &middot; ' + q.flightTime + '</div>' +
    '</div>' +
    '<div class="section-title">Price Breakdown</div>' +
    '<div style="background:var(--card2);border:1px solid var(--border2);border-radius:14px;padding:16px;margin-bottom:16px;">' +
      '<div class="payment-line"><span class="pl-label">Charter Flight</span><span class="pl-val">$' + q.price.toLocaleString() + '</span></div>' +
      '<div class="payment-line"><span class="pl-label">Catering</span><span class="pl-val">Included</span></div>' +
      '<div class="payment-line"><span class="pl-label">FBO Fees</span><span class="pl-val">Included</span></div>' +
      '<div class="payment-line"><span class="pl-label">Platform Fee</span><span class="pl-val" style="color:var(--green);">$0</span></div>' +
      '<div class="total-line"><span>Total</span><span class="total-val">$' + q.price.toLocaleString() + '</span></div>' +
    '</div>' +
    '<div class="section-title">Payment</div>' +
    '<div class="card-field-wrap">' +
      '<div class="field-wrap"><div class="field-label">Card Number</div><input class="field-input" placeholder="4242 4242 4242 4242"></div>' +
      '<div class="card-row">' +
        '<div class="field-wrap" style="flex:1"><div class="field-label">Expiry</div><input class="field-input" placeholder="MM / YY"></div>' +
        '<div class="field-wrap" style="flex:1"><div class="field-label">CVV</div><input class="field-input" placeholder="123"></div>' +
      '</div>' +
      '<div class="field-wrap"><div class="field-label">Cardholder Name</div><input class="field-input" placeholder="Full name on card"></div>' +
    '</div>' +
    '<div style="font-size:11px;color:var(--text3);line-height:1.7;margin-top:2px;">By confirming, you agree to Aviate Atelier\'s Booking Terms. Payment is processed securely via Stripe. All bookings are confirmed immediately.</div>';
  document.getElementById('booking-body').innerHTML = html;
}
function selPref(el, group) {
  document.querySelectorAll('.pref-option[data-val]').forEach(function(o){
    if (group === 'catering' && ['none','light','full'].includes(o.dataset.val)) o.classList.remove('sel');
    if (group === 'transport' && ['none','suv','sedan'].includes(o.dataset.val)) o.classList.remove('sel');
  });
  el.classList.add('sel');
}
function addPax() {
  _passengers = Math.min(14, _passengers + 1);
  _passengerForms.push({});
  document.getElementById('pax-count').textContent = _passengers;
  renderPassengerStep();
}
function removePax(idx) {
  _passengers = Math.max(1, _passengers - 1);
  _passengerForms.splice(idx, 1);
  renderPassengerStep();
}
function bookingNext() {
  if (_bookingStep < 3) {
    _bookingStep++;
    renderBookingStep();
    document.getElementById('booking-body').scrollTop = 0;
  } else {
    confirmBooking();
  }
}
function bookingBack() {
  if (_bookingStep > 1) {
    _bookingStep--;
    renderBookingStep();
  } else {
    showAppScreen('results');
  }
}
function confirmBooking() {
  // Save confirmed booking to Supabase
  if (_clientRecord && _selectedQuote) {
    _sb.from('bookings').insert({
      client_id: _clientRecord.id,
      total_paid: _selectedQuote.price,
      platform_commission: Math.round(_selectedQuote.price * 0.05),
      operator_settlement: Math.round(_selectedQuote.price * 0.95),
      status: 'confirmed',
      catering_level: 'none'
    }).then(function(res) {
      if (res.error) console.warn('Booking save:', res.error.message);
    });
  }
  showAppScreen('trips');
  switchAppTab('trips', document.querySelectorAll('.bn-i')[1]);
  loadTrips('upcoming');
  showToast('&#x2713;','Booking Confirmed!','Your charter is booked \u00b7 Confirmation sent to ' + (_user ? _user.email : 'your email'));
}

// ── TRIPS ──
function loadTrips(filter) { filterTrips(filter, null); }
function filterTrips(filter, el) {
  if (el) {
    document.querySelectorAll('.tt-btn').forEach(b => b.classList.remove('active'));
    el.classList.add('active');
  }
  var trips = MOCK_TRIPS[filter] || [];
  var html = '';
  for (var i=0; i < trips.length; i++) {
    var t = trips[i];
    var statusClass = 'tc-st-' + t.status;
    var statusLabel = t.status === 'upcoming' ? 'Upcoming' : t.status === 'pending' ? 'Awaiting Quotes' : 'Completed';
    html += '<div class="trip-card">' +
      '<div class="tc-route">' + t.route + '</div>' +
      '<div class="tc-meta">' + t.date + ' &middot; ' + t.pax + ' pax</div>' +
      '<span class="tc-status ' + statusClass + '">' + statusLabel + '</span>' +
      '<div class="tc-footer"><span class="tc-aircraft">' + t.aircraft + '</span><span class="tc-price">' + t.price + '</span></div>' +
    '</div>';
  }
  if (!trips.length) html = '<div style="text-align:center;padding:40px;color:var(--text3);">No ' + filter + ' trips</div>';
  document.getElementById('trips-list').innerHTML = html;
}

// ── TOAST ──
function showToast(ico, msg, sub) {
  var t = document.getElementById('toast');
  document.getElementById('toast-ico').innerHTML = ico;
  document.getElementById('toast-msg').textContent = msg;
  document.getElementById('toast-sub').textContent = sub || '';
  t.classList.add('show');
  setTimeout(function(){ t.classList.remove('show'); }, 3500);
}

// Set today's date on load
(function(){ var d = new Date(); d.setDate(d.getDate()+1); var el = document.getElementById('flight-date'); if(el) el.value = d.toISOString().split('T')[0]; })();
</script>
</body>
</html>